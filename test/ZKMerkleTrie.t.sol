// SPDX-License-Identifier: MIT
pragma solidity 0.8.15;

import { Portal_Initializer } from "./CommonTest.t.sol";

contract ZKMerkleTrie_Test is Portal_Initializer {
    function test_verifyInclustionProof_valid_0() external {
        bytes[] memory proofs = new bytes[](2);
        proofs[
            0
        ] = hex"012098f5fb9e239eab3ceac3f27b81e481dc3124d55ffed523a839ee8446b64864010100000000000000000000000000000000000000000000000000000000000000003039202098f5fb9e239eab3ceac3f27b81e481dc3124d55ffed523a839ee8446b64864";
        proofs[
            1
        ] = hex"5448495320495320534f4d45204d4147494320425954455320464f5220534d54206d3172525867503278704449";
        assertTrue(
            zkMerkleTrie.verifyInclusionProof(
                hex"0000000000000000000000000000000000000000000000000000000000000000",
                hex"0000000000000000000000000000000000000000000000000000000000003039",
                proofs,
                hex"1a71d0943087a54143a948ccb9d9f0bd07c99d3a4899c9ceeb890976c32186c1"
            )
        );
    }

    function test_verifyInclustionProof_valid_1() external {
        bytes[] memory proofs = new bytes[](8);
        proofs[
            0
        ] = hex"000ab62fdcebb5220c92b96d38cef426d805217d1760140b2b1eebecd436c8fcc50f3dcecebf602601ceb35f1996e70c802634bb3d7ccbc7ad6b923e00066e8b00";
        proofs[
            1
        ] = hex"0006be779477fdea72fc037851ef2baa70afdeff1075cfaa3b4f385e9d2336afd42583e724fe0eb10e675ab6be869557ca5d2f9fc13de9274a0a1742236e349caf";
        proofs[
            2
        ] = hex"000ded681649ba8fee8a5cb411c9a2d1c525e796ca2566cebf2c0244c2a66491662c67be5020784f6a1eb8d7f1bfc7d921455e231d9bd9f171dffa4202763e2d28";
        proofs[
            3
        ] = hex"0009543051b94eaaf3560c2f33cd8bf9a9b93f712b1f9b41ab67cab4f12733a67d167c33ebb5960ce90cf4042434bc4f9cd75c5ecc46e250c5c4b06a76a4627b2b";
        proofs[
            4
        ] = hex"0010c440dc7007099878005966c61e751fe67bafcdb37615213c8ff9d111b4f7251167fcaa928ceeb39b9318cea6306ac2cd6252f6ef8d96cfeffd937810b29b1a";
        proofs[
            5
        ] = hex"00271dd669b4787c31020d57ee2b2e56ff139994b52bf56ecc9f7432a272ce5f78032d185fae0284cbf7292557e98dfd08dea8b108eb6e4289d803d2b7d2e74644";
        proofs[
            6
        ] = hex"0109d279cfc7bcba04074acfebd9974c1d2c9516b2c1f18ec34ac3ed422158c8a8010100000000000000000000000000000000000000000000000000000000000000000018200e9449cefab8e4070797d09578e909e10a0ce4374ea5e4d4c608c2e11961af68";
        proofs[
            7
        ] = hex"5448495320495320534f4d45204d4147494320425954455320464f5220534d54206d3172525867503278704449";
        assertFalse(
            zkMerkleTrie.verifyInclusionProof(
                hex"0000000000000000000000000000000000000000000000000000000000000005",
                hex"0000000000000000000000000000000000000000000000000000000000000032",
                proofs,
                hex"0ef999685f185097340822d0b30f846398e641087ba3bcff823ed87538038943"
            )
        );
    }

    function test_verifyInclustionProof_valid_2() external {
        bytes[] memory proofs = new bytes[](8);
        proofs[
            0
        ] = hex"000ab62fdcebb5220c92b96d38cef426d805217d1760140b2b1eebecd436c8fcc50f3dcecebf602601ceb35f1996e70c802634bb3d7ccbc7ad6b923e00066e8b00";
        proofs[
            1
        ] = hex"0006be779477fdea72fc037851ef2baa70afdeff1075cfaa3b4f385e9d2336afd42583e724fe0eb10e675ab6be869557ca5d2f9fc13de9274a0a1742236e349caf";
        proofs[
            2
        ] = hex"0017c443967900c45fb5b11c7a40cfc8e4aa5c699f2f80add51e3cf998ed9872b80022374777da27caa6013c01e2cb3b2d974a998a4f38f2f25baa3c87ad12a007";
        proofs[
            3
        ] = hex"0024622a111942a41d45c768f89da131621e0fa266b9b7e324d33e458702a2987e0e67ba58319668fa44fe1f5e20f5a7978e6577bcb1b9809e101224c2988edd38";
        proofs[
            4
        ] = hex"00139b85edf9b10c2b2330eb06a1eeb66f2058a8d9cd6fea738157f951e8079905068c3814e7511d563e5bfea099e5368ee7a8e38e4856e85b45b33339621ff50c";
        proofs[
            5
        ] = hex"000b1bb0d1d5eaa0e39a52d08db2e92b79294959ea25cef6757a4d54bff691fb902ee69c6f3bb0450146447b2f9865d2e396b7b9e7b37d7f2ff181c85941ef98cf";
        proofs[
            6
        ] = hex"0117f011179feb4d1c750e4c139df9e5d1940dffa118c8d489c852389aa7afaf460101000000000000000000000000000000000000000000000000000000000000000000062017f011179feb4d1c750e4c139df9e5d1940dffa118c8d489c852389aa7afaf46";
        proofs[
            7
        ] = hex"5448495320495320534f4d45204d4147494320425954455320464f5220534d54206d3172525867503278704449";
        assertTrue(
            zkMerkleTrie.verifyInclusionProof(
                hex"101e368776582e57ab3d116ffe2517c0a585cd5b23174b01e275c2d8329c3d83",
                hex"0000000000000000000000000000000000000000000000000000000000000006",
                proofs,
                hex"0ef999685f185097340822d0b30f846398e641087ba3bcff823ed87538038943"
            )
        );
    }

    function test_verifyInclustionProof_valid_3() external {
        bytes[] memory proofs = new bytes[](9);
        proofs[
            0
        ] = hex"000ab62fdcebb5220c92b96d38cef426d805217d1760140b2b1eebecd436c8fcc50f3dcecebf602601ceb35f1996e70c802634bb3d7ccbc7ad6b923e00066e8b00";
        proofs[
            1
        ] = hex"00064ef83727d84baa6f69e7b6d2aa09c06a0a684aee47027b0b364011ec29a61617909e79d23c9ffd920c6e0cb9929782348bcd170d8a5d806467fbcf9d56b437";
        proofs[
            2
        ] = hex"0016b9762acc15c49266ff4561a8975cbd5e132ad5129caa0b811b374cff9480101152ad4e5c71d0348e3b9041315496011ab29e79a54851d0d79d7d03dd2423c8";
        proofs[
            3
        ] = hex"0017ae8d541b010b836adb59a87754efee7740f33b96520754ca5f6f6ae9d3b73e09827fa4836bb60157a2e4e358d897b23d735c3b23f55490e76f2e6ae2b68b04";
        proofs[
            4
        ] = hex"0016c3abb95e2baec8aab3dc244eac879d60ac0ef6275cd4fa5c3a526049fdeb8c11b76fb8c45df3936b13c24dff4da46b947a2844f06ac6221e8c8eb7feb32970";
        proofs[
            5
        ] = hex"000ccffa8b08f54fc92c60c9c19f379d5759ecdd8fded0b24c2266be5a6fafb7c4295abf4ea1b55932420231efee9fe391a90b3fb077aee16e26ebba7997795e7f";
        proofs[
            6
        ] = hex"0014ed76b6e85369cd2549423310e621bbcbcac05402162d085be4368168ca506b0000000000000000000000000000000000000000000000000000000000000000";
        proofs[7] = hex"02";
        proofs[
            8
        ] = hex"5448495320495320534f4d45204d4147494320425954455320464f5220534d54206d3172525867503278704449";
        assertFalse(
            zkMerkleTrie.verifyInclusionProof(
                hex"bc36789e7a1e281436464229828f817d6612f7b477d66591ff96a9e064bcc98a",
                hex"0000000000000000000000000000000000000000000000000000000000000032",
                proofs,
                hex"0ef999685f185097340822d0b30f846398e641087ba3bcff823ed87538038943"
            )
        );
    }

    function test_verifyInclustionProof_valid_4() external {
        bytes[] memory proofs = new bytes[](13);
        proofs[
            0
        ] = hex"0007cbd8ed414f4c32c8f24bcd4a092ca1fc48c5dc95acb388fa3c08ec3422be2f11dd580249f54d7db79ee465707fa4e23c4287a4649248df30583903858aa90d";
        proofs[
            1
        ] = hex"0023baa0bbc530f48f150951aa7670aa3c8f6570a5c763c05413a3e12a6c0b7cce10f98a7af3a8a73a3a20af4a000ef3663712967ec273a58e9ade9e661394c9d6";
        proofs[
            2
        ] = hex"00284ac3e3a591145890ace584756f6ba06c701f395c8db9d0313adcdaf954270b006c473617966db462b9fd00299d683a15c0b74454ca7ac3ef2d8aa087ac7dac";
        proofs[
            3
        ] = hex"00296063f48eb3a4f4ff8fdc10316f114be5bedfbf79c9c86d325f92ff877a1a532ff1456213f17f8b67c69ea1821714fc7fb5073bf7c1fc4f77adaec58d083c6e";
        proofs[
            4
        ] = hex"002c58643b19811246202ac95ce7122cf63eb17687e12a670542c2bd76546184ef02acd9795883b244ab8c5c9b232c7a6f598ab360bcd5b6fdab4ca93250b74ce8";
        proofs[
            5
        ] = hex"00015421c239dc34b78b2fa31b208aa368cd1eae4b98aa10ae03bc2c5b80cdd8ef2d6c19f2f3b16de567490f18819cae1e3f4ea29d2bc5c34400276cf57f0e3b63";
        proofs[
            6
        ] = hex"002d961fc76c9c30673b93f089451bce1d3af8ada972ad8c735f60cd0e145751801962d7c2d9d222562ae4476172398601558339c4414a807d280ec23938fa6d78";
        proofs[
            7
        ] = hex"0000000000000000000000000000000000000000000000000000000000000000000949fcaefea105109e6bd0c339373e06d8a7856fc82c3185041642ed42f07585";
        proofs[
            8
        ] = hex"0014660f419e10516425d4f78bbf7457cfd1381fff1223606dc530792059176c3f20ae2c31258e0712e4e39ecd2eae272ec13fadb2f057027e7fad2b378fc249f6";
        proofs[
            9
        ] = hex"00163340375c6665b9878b1443e55b943de727fd6ccb1647ec9ca2e09a0f6b81110000000000000000000000000000000000000000000000000000000000000000";
        proofs[
            10
        ] = hex"00224e3507691f5789978473cf4a307908f5a08761112466f1cf970bc8fad921d9258216ceb8dffd636ddc9570e526bc6741d8f76e8f2d8cb843104656c8a93ae5";
        proofs[
            11
        ] = hex"011fd5bbabb0ebd74c646925592018a1f5d06dd11a6b5be33f025241736e454087010100000000000000000000000000000000000000000000000000000000000000000005201fd5bbabb0ebd74c646925592018a1f5d06dd11a6b5be33f025241736e454087";
        proofs[
            12
        ] = hex"5448495320495320534f4d45204d4147494320425954455320464f5220534d54206d3172525867503278704449";
        assertTrue(
            zkMerkleTrie.verifyInclusionProof(
                hex"2b232c97452f0950c94e2539fdc7e69d21166113cf7a9bcb99b220a3fe5d720a",
                hex"0000000000000000000000000000000000000000000000000000000000000005",
                proofs,
                hex"122f20d691c10bf842b594733bdc73e6a67a131def85ef444ce58a18cc4cd757"
            )
        );
    }

    function test_verifyInclustionProof_valid_5() external {
        bytes[] memory proofs = new bytes[](11);
        proofs[
            0
        ] = hex"00284ec4ede7c4da8296ce6d515233c2eea76fd5c07116c56949fda88770fad4b811b40ba55c3d2ec14871670b38cec7c71ea67ddb0ceaa0fea936e8b6fd8e0511";
        proofs[
            1
        ] = hex"000d12650b10e106a7644599be80c71ab31cf093d7f99c34d866315ca1c12972022409d4725c6af5e20a9e32a61d79e85571181d65c45dc10bfc11ba2857923830";
        proofs[
            2
        ] = hex"00296bec9e31b0aa1c5128fca361dd3875609520c9b0c8e7dd73bda2a1313c18d72eed91ecfef85e13834fda24ddf9060a69eec25abba55115c517de9f8a4ee9ec";
        proofs[
            3
        ] = hex"00131748240aea4f74ae3be5a6a9f11d6bbb3129241f36de98275c32423592de8b16c111e32818a1cdc9b30d4855817e3193945bbf2594291bb229d85d2ed81658";
        proofs[
            4
        ] = hex"001cdea41e120cf4086d178996edcf44e2003f2d0225cbac864c7e60af23540f2f010f74b267d3bd19343889f0d2a525d7054c007e507c5ca0164be42f72215ff6";
        proofs[
            5
        ] = hex"000ac5febcd01ab220937cef032f250f499fe68911bc094ebe5c7b8abb59e41dc6191416975dbc10cf89f6428771b2251e9023598fcbc59ad33be4f05c6e7b8eec";
        proofs[
            6
        ] = hex"0026080a7dc62fc9fafc28adb4775111ee0d6818d6fc07375f751f602f0708a17f211fc5be39244df796912c7360f30219760366342a9c4306d710ec2bd2b5db39";
        proofs[
            7
        ] = hex"0013867a8f88775425fc040b935515ce4966f9492956f96e7355fadfba44e1f67d0000000000000000000000000000000000000000000000000000000000000000";
        proofs[
            8
        ] = hex"00233da726018d913514b4dd9398bc1a01c98b0a8ef4c33dc20efae3c38e1fe1912ef80e02108f98b180588ae6580404cfb5fb52b22ebfa1345da5654587b5aec5";
        proofs[
            9
        ] = hex"012f6fdd1ad0dd1863abaa7b339f6f56b17a97720aeddd790f4507b95a5ef6df55010100000000000000000000000000000000000000000000000000000000000000000005202f6fdd1ad0dd1863abaa7b339f6f56b17a97720aeddd790f4507b95a5ef6df55";
        proofs[
            10
        ] = hex"5448495320495320534f4d45204d4147494320425954455320464f5220534d54206d3172525867503278704449";
        assertTrue(
            zkMerkleTrie.verifyInclusionProof(
                hex"e2689cd4a84e23ad2f564004f1c9013e9589d260bde6380aba3ca7e09e4df40c",
                hex"0000000000000000000000000000000000000000000000000000000000000005",
                proofs,
                hex"2f362a32462155cc2f9d2d7aa2f70c0c80cd3ff834c69de7bcc4fb2d493b0e9b"
            )
        );
    }

    // Real withdrawal example
    function test_verifyInclustionProof_valid_6() external {
        bytes[] memory proofs = new bytes[](7);
        proofs[
            0
        ] = hex"002c4b1cef0d03c37f45c631f7fc85ea4b78eeb096708ea63bd810463e246f13d40eb41f1061285f9c13a21519bdb76cba404832d33945ad471fa215153d9b020d";
        proofs[
            1
        ] = hex"0000000000000000000000000000000000000000000000000000000000000000001dc169aab556ca90e4a7c3365ab27ba5ca93d222cd9e25e3ae1e38b7bf3a9e94";
        proofs[
            2
        ] = hex"0007dcec580d43183a7dbe05d3a5a1f8b3ce38d5bb22676dfa1439ab44219de2a0036b366d8dcd20a1872355bb66868eb50f78599e926963ca33d35b8535e9525b";
        proofs[
            3
        ] = hex"0000000000000000000000000000000000000000000000000000000000000000001747ce9cfac94135832e7e7d983a44e894446ca8ff1e6bda10ebcdaae36eba3d";
        proofs[
            4
        ] = hex"0020438463bdf532b3eaa113e69847b469b76425d47195ed7a41462a79ba6511f715cb3972fcd254f29388ca61de787fe3654d776941fb4eaf00a946e8d4c73720";
        proofs[
            5
        ] = hex"0105a0af8df2be333495be279be0eb5ef7da41b240832f2d74d34631333cebc3ee0101000000000000000000000000000000000000000000000000000000000000000000012085359a58748add24fbe1c5aedbd158736f50a45baf8715b9f32c9432ea7c179a";
        proofs[
            6
        ] = hex"5448495320495320534f4d45204d4147494320425954455320464f5220534d54206d3172525867503278704449";
        assertTrue(
            zkMerkleTrie.verifyInclusionProof(
                hex"85359a58748add24fbe1c5aedbd158736f50a45baf8715b9f32c9432ea7c179a",
                hex"0000000000000000000000000000000000000000000000000000000000000001",
                proofs,
                hex"2830ab4d0fa292abe8f69ac23b8d98a9f9a950ace6ae50d0f77eefa01a644cb1"
            )
        );
    }
}
